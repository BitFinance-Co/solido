(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[309],{3905:function(e,t,n){"use strict";n.d(t,{Zo:function(){return m},kt:function(){return k}});var a=n(7294);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,i=function(e,t){if(null==e)return{};var n,a,i={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var s=a.createContext({}),p=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},m=function(e){var t=p(e.components);return a.createElement(s.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},d=a.forwardRef((function(e,t){var n=e.components,i=e.mdxType,r=e.originalType,s=e.parentName,m=l(e,["components","mdxType","originalType","parentName"]),d=p(n),k=i,c=d["".concat(s,".").concat(k)]||d[k]||u[k]||r;return n?a.createElement(c,o(o({ref:t},m),{},{components:n})):a.createElement(c,o({ref:t},m))}));function k(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var r=n.length,o=new Array(r);o[0]=d;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:i,o[1]=l;for(var p=2;p<r;p++)o[p]=n[p];return a.createElement.apply(null,o)}return a.createElement.apply(null,n)}d.displayName="MDXCreateElement"},2374:function(e,t,n){"use strict";n.r(t),n.d(t,{frontMatter:function(){return o},metadata:function(){return l},toc:function(){return s},default:function(){return m}});var a=n(2122),i=n(9756),r=(n(7294),n(3905)),o={},l={unversionedId:"WIP/Governance/governance-downstream",id:"WIP/Governance/governance-downstream",isDocsHomePage:!1,title:"Governance Downstream",description:"Governance in the Downstream Programs",source:"@site/docs/WIP/Governance/governance-downstream.md",sourceDirName:"WIP/Governance",slug:"/WIP/Governance/governance-downstream",permalink:"/docs/WIP/Governance/governance-downstream",version:"current",frontMatter:{}},s=[{value:"Governance in the Downstream Programs",id:"governance-in-the-downstream-programs",children:[]},{value:"1. Stake Pool Program",id:"1-stake-pool-program",children:[{value:"Upgrade Authority",id:"upgrade-authority",children:[]},{value:"Manager Role",id:"manager-role",children:[]},{value:"Staker Role",id:"staker-role",children:[]}]},{value:"2. Lido Program",id:"2-lido-program",children:[{value:"Upgrade Authority",id:"upgrade-authority-1",children:[]},{value:"Owner Role",id:"owner-role",children:[]},{value:"Whitelist for Maintenance Responsibilities",id:"whitelist-for-maintenance-responsibilities",children:[]},{value:"Gating DelegateDeposits",id:"gating-delegatedeposits",children:[]},{value:"Staker Role Responsibilities",id:"staker-role-responsibilities",children:[]},{value:"Fee Params",id:"fee-params",children:[]},{value:"PauseDeposits",id:"pausedeposits",children:[]}]}],p={toc:s};function m(e){var t=e.components,n=(0,i.Z)(e,["components"]);return(0,r.kt)("wrapper",(0,a.Z)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h3",{id:"governance-in-the-downstream-programs"},"Governance in the Downstream Programs"),(0,r.kt)("p",null,"This note documents governance related changes/additions we seek in the two 'child' programs"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Stake Pool Program"),(0,r.kt)("li",{parentName:"ol"},"Lido Program")),(0,r.kt)("p",null,"It assumes that we have already setup the 'parent' program - i.e. the Governance program (multi-sig or otherwise) and the relevant signatory address for the Governance is at ",(0,r.kt)("inlineCode",{parentName:"p"},"0xGovernance")),(0,r.kt)("p",null,"In the context of the ",(0,r.kt)("inlineCode",{parentName:"p"},"Serum Multisig")," program that we are using, ",(0,r.kt)("inlineCode",{parentName:"p"},"0xGovernance")," refers to PDA discussed in ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/ChorusOne/solido/issues/26#issuecomment-829439107"},"this comment")),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"From the multisig account and the Multisig program id, we get a program derived address. This is the address that the multisig can sign with, so this is the one that you can set as e.g. the upgrade authority for the Lido program.")),(0,r.kt)("hr",null),(0,r.kt)("h2",{id:"1-stake-pool-program"},"1. Stake Pool Program"),(0,r.kt)("h3",{id:"upgrade-authority"},"Upgrade Authority"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Assuming we are going to deploy our own Stake Pool Program",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"(and maintain it)"),(0,r.kt)("li",{parentName:"ul"},"We need to set upgrade authority of this deployment to ",(0,r.kt)("inlineCode",{parentName:"li"},"0xGovernance"))))),(0,r.kt)("h3",{id:"manager-role"},"Manager Role"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Set to ",(0,r.kt)("inlineCode",{parentName:"li"},"0xGovernance"))),(0,r.kt)("h3",{id:"staker-role"},"Staker Role"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Set to Lido Program",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"This might involve a chicken-egg situation at init."),(0,r.kt)("li",{parentName:"ul"},"One potential resolution",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("ol",{parentName:"li"},(0,r.kt)("li",{parentName:"ol"},"On initialisation of Stake Pool : set ",(0,r.kt)("inlineCode",{parentName:"li"},"Staker Role")," of ",(0,r.kt)("inlineCode",{parentName:"li"},"Stake Pool Program")," to be ",(0,r.kt)("inlineCode",{parentName:"li"},"0xGovernance")))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("ol",{parentName:"li",start:2},(0,r.kt)("li",{parentName:"ol"},"Then deploy and initialise the Lido Program (say, at ",(0,r.kt)("inlineCode",{parentName:"li"},"0xLido"),")"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("ol",{parentName:"li",start:3},(0,r.kt)("li",{parentName:"ol"},"Then modify ",(0,r.kt)("inlineCode",{parentName:"li"},"Staker Role")," of ",(0,r.kt)("inlineCode",{parentName:"li"},"Stake Pool Program")," = ",(0,r.kt)("inlineCode",{parentName:"li"},"0xLido"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"use the ",(0,r.kt)("inlineCode",{parentName:"li"},"SetStaker")," instruction of StakePool Program")))))))))),(0,r.kt)("hr",null),(0,r.kt)("h2",{id:"2-lido-program"},"2. Lido Program"),(0,r.kt)("h3",{id:"upgrade-authority-1"},"Upgrade Authority"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"While deploying the Lido program, set upgrade authority to",(0,r.kt)("inlineCode",{parentName:"li"},"0xGovernance"))),(0,r.kt)("h3",{id:"owner-role"},"Owner Role"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Lido Program has an owner role to be provided at init"),(0,r.kt)("li",{parentName:"ul"},"Set this owner to be",(0,r.kt)("inlineCode",{parentName:"li"},"0xGovernance")),(0,r.kt)("li",{parentName:"ul"},"I am going to reference this as ",(0,r.kt)("inlineCode",{parentName:"li"},"Lido Owner")," in all the notes below.")),(0,r.kt)("h3",{id:"whitelist-for-maintenance-responsibilities"},"Whitelist for Maintenance Responsibilities"),(0,r.kt)("h4",{id:"context"},"Context"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"There are certain maintenance actions/instructions in the Lido Program",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"eg. delegating SOL in Lido Program across validators in Stake Pool Program"),(0,r.kt)("li",{parentName:"ul"},"eg. rebalancing stakes"))),(0,r.kt)("li",{parentName:"ul"},"Requiring ",(0,r.kt)("inlineCode",{parentName:"li"},"Lido Owner")," (aka the multisig governance) to sign off each time would be overkill for these responsibilities"),(0,r.kt)("li",{parentName:"ul"},"Opening these to anyone-can-call might be abused by jokers")),(0,r.kt)("h4",{id:"solution"},"Solution"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Midway Solution - A Whitelist of Maintainers"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Lido Program to maintain a list of addresses corresponding to maintainers"),(0,r.kt)("li",{parentName:"ul"},"All Maintenance responsibilities are gated to 'onlyMaintainers'"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"Lido Owner")," is part of the list"),(0,r.kt)("li",{parentName:"ul"},"Additionally, ",(0,r.kt)("inlineCode",{parentName:"li"},"Lido Owner")," can add/remove addresses from this list"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Potential Implementation"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Store this list in the Lido State - ",(0,r.kt)("inlineCode",{parentName:"p"},"Maintainers_List"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"We will need instructions for ",(0,r.kt)("inlineCode",{parentName:"p"},"Add Maintainer")," / ",(0,r.kt)("inlineCode",{parentName:"p"},"Remove Maintainer")),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"These two instructions are gated to 'onlyLidoOwner'"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Create a method in state.rs : ",(0,r.kt)("inlineCode",{parentName:"p"},"check_maintainer")),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"This is similar to ",(0,r.kt)("inlineCode",{parentName:"li"},"check_manager")," in the Stake Pool library (",(0,r.kt)("inlineCode",{parentName:"li"},"state.rs"),")"),(0,r.kt)("li",{parentName:"ul"},"Returns true only if the signer is in the list (and has proper signature)",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Question for Fynn : How costly will this lookup be? (Say a list of 20 maintainers?)"))))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Add ",(0,r.kt)("inlineCode",{parentName:"p"},"check_maintainer")," in the implementation of instructions you want to gate to ",(0,r.kt)("inlineCode",{parentName:"p"},"onlyMaintainers")))))),(0,r.kt)("h3",{id:"gating-delegatedeposits"},"Gating DelegateDeposits"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"As discussed above : gate DelegateDeposit to ",(0,r.kt)("inlineCode",{parentName:"li"},"onlyMaintainers"))),(0,r.kt)("h3",{id:"staker-role-responsibilities"},"Staker Role Responsibilities"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"p"},"Staker Role")," of Stake Pool Program will be the Lido Program")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"p"},"Staker Role")," corresponds to following responsibilities (instructions) in the Stake Pool Program"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre"},"-  1. Set_Staker (needs signature of both manager and staker)\n-  2. CreateValidatorStakeAccount\n-  3. AddValidatorFromPool\n-  4. RemoveValidatorFromPool\n\n-  5. DecreaseValidatorStake\n-  6. IncreaseValidatorStake\n\n"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"We need to proxy these instructions via the Lido Program"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Proxy Instructions 1. to 4. and gate them to ",(0,r.kt)("inlineCode",{parentName:"li"},"onlyLidoOwner")),(0,r.kt)("li",{parentName:"ul"},"Proxy Instructions 5., 6. and gate them to ",(0,r.kt)("inlineCode",{parentName:"li"},"onlyMaintainers"))))),(0,r.kt)("h3",{id:"fee-params"},"Fee Params"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"These params are listed in ",(0,r.kt)("a",{parentName:"li",href:"fee-management.md"},"Fee Management Document")),(0,r.kt)("li",{parentName:"ul"},"We need to maintain these params in the Lido Program"),(0,r.kt)("li",{parentName:"ul"},"We will need to add functions to modify these params - and gate them to onlyLidoOwner")),(0,r.kt)("h3",{id:"pausedeposits"},"PauseDeposits"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Discuss if we need a way to pause deposits"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"We might need this early on, when the Lido Program is initialised but we are still setting up params, validators etc"),(0,r.kt)("li",{parentName:"ul"},"There might be a reason to pause deposits - at some later point too. eg. bug discovered, need to upgrade Lido"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Potential Implementation"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"A boolean flag ",(0,r.kt)("inlineCode",{parentName:"li"},"PAUSE_DEPOSITS")," initially set to ",(0,r.kt)("inlineCode",{parentName:"li"},"TRUE")),(0,r.kt)("li",{parentName:"ul"},"Only editable by ",(0,r.kt)("inlineCode",{parentName:"li"},"Lido Owner")," (aka 0xGovernance)"),(0,r.kt)("li",{parentName:"ul"},"Once everything is setup, ",(0,r.kt)("inlineCode",{parentName:"li"},"Lido Owner")," can set this to ",(0,r.kt)("inlineCode",{parentName:"li"},"FALSE ")),(0,r.kt)("li",{parentName:"ul"},"The implementation function for Deposit - does an upfront check for ",(0,r.kt)("inlineCode",{parentName:"li"},"PAUSE_DEPOSITS")," - and fails if it is ",(0,r.kt)("inlineCode",{parentName:"li"},"TRUE"),".")))))}m.isMDXComponent=!0}}]);