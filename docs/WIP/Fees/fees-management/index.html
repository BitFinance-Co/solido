<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.0">
<link rel="alternate" type="application/rss+xml" href="/solido/blog/rss.xml" title="Lido for Solana Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/solido/blog/atom.xml" title="Lido for Solana Blog Atom Feed">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous"><title data-react-helmet="true">Fees Management | Lido for Solana</title><meta data-react-helmet="true" property="og:url" content="https://chorusone.github.io/solido/docs/WIP/Fees/fees-management"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Fees Management | Lido for Solana"><meta data-react-helmet="true" name="description" content="Fee Management"><meta data-react-helmet="true" property="og:description" content="Fee Management"><link data-react-helmet="true" rel="shortcut icon" href="/solido/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://chorusone.github.io/solido/docs/WIP/Fees/fees-management"><link data-react-helmet="true" rel="alternate" href="https://chorusone.github.io/solido/docs/WIP/Fees/fees-management" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://chorusone.github.io/solido/docs/WIP/Fees/fees-management" hreflang="x-default"><link rel="stylesheet" href="/solido/assets/css/styles.f14eb037.css">
<link rel="preload" href="/solido/assets/js/runtime~main.bb7db0a5.js" as="script">
<link rel="preload" href="/solido/assets/js/main.15924cad.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#main" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle" type="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/solido/"><img src="/solido/img/lido-droplet-round.svg" alt="Lido for Solana Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/solido/img/lido-droplet-round.svg" alt="Lido for Solana Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><strong class="navbar__title">Lido for Solana</strong></a><a class="navbar__item navbar__link" href="/solido/docs/">Documentation</a></div><div class="navbar__items navbar__items--right"><a href="https://medium.com/chorus-one/introducing-lido-for-solana-8aa02db8503" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Blog</a><a href="https://github.com/chorusone/solido" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="react-toggle displayOnlyInLargeViewport_GrZ2 react-toggle--disabled" role="button" tabindex="-1"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_71bT">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">ðŸŒž</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/solido/"><img src="/solido/img/lido-droplet-round.svg" alt="Lido for Solana Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/solido/img/lido-droplet-round.svg" alt="Lido for Solana Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><strong class="navbar__title">Lido for Solana</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/solido/docs/">Documentation</a></li><li class="menu__list-item"><a href="https://medium.com/chorus-one/introducing-lido-for-solana-8aa02db8503" target="_blank" rel="noopener noreferrer" class="menu__link">Blog</a></li><li class="menu__list-item"><a href="https://github.com/chorusone/solido" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper docs-wrapper doc-page"><div class="docPage_31aa"><main class="docMainContainer_3ufF docMainContainerEnhanced_3NYZ"><div class="container padding-vert--lg docItemWrapper_3FMP"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><header><h1 class="docTitle_3a4h">Fees Management</h1></header><div class="markdown"><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="fee-management"></a>Fee Management<a class="hash-link" href="#fee-management" title="Direct link to heading">#</a></h2><p>Status - As of 6 May 2021</p><ul><li>First Draft. To be discussed with Fynn.</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="what-do-we-want-to-achieve"></a>What do we want to achieve?<a class="hash-link" href="#what-do-we-want-to-achieve" title="Direct link to heading">#</a></h3><ul><li><p>We want to take X% of the staking Fees as fees and distribute them across Lido stakeholders.</p></li><li><p>X is set by Lido Governance (default : 10%)</p></li><li><p>Who are these stakeholders and what is the distribution pattern?</p><ul><li><p>Insurance Fund : a% (of the X%)</p></li><li><p>Treasury Fund : b%</p></li><li><p>Chorus One Fund : c%</p></li><li><p>Validator Fund : d% (Further, this is distributed equally across the current list of validators)</p></li><li><p>(a+b+c+d) = 100%</p></li></ul></li><li><p>TODO : Check with Felix about Chorus One</p></li><li><p>Following from the design in Lido for ETH, ideally the fee would be distributed across stakeholders  in the form of LSOL tokens.</p></li></ul><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="how-do-we-achieve-this"></a>How do we achieve this?<a class="hash-link" href="#how-do-we-achieve-this" title="Direct link to heading">#</a></h3><ul><li><p>Jon has added a generic <code>Fee Cut on Fees</code> Mechanism to the Stake Pool Program</p><ul><li><p>the mechanism ensures fee goes to a fee beneficiary : in the form of stake pool tokens.</p><ul><li>we need to make sure this mechanism is configured correctly in our deployment.</li><li>eg. Fee Cut, Beneficiary</li></ul></li></ul></li><li><p>Additionally, we need functionality to distribute these fees across all stakeholders in the form of LSOL tokens.</p></li><li><p>This would require additions to the Lido Program</p></li></ul><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="context--stake-pool-program"></a>Context : Stake Pool Program<a class="hash-link" href="#context--stake-pool-program" title="Direct link to heading">#</a></h3><ul><li><p>In the Stake Pool program, one can set the Fee percentage on initialisation - with the relevant parameter being <code>stake_pool.fee</code></p></li><li><p>Also, on initialisation, one can set the Fee Beneficiary : <code>stake_pool.manager_fee_account</code></p></li><li><p>Everytime <code>UpdateStakePoolBalance</code> instruction is called, the latest staking Fees are calculated and <code>Fee Percentage</code> of these new Fees go to the <code>Fee Beneficiary</code> in the form of Stake Pool Tokens</p></li><li><p>Additionally, manager can update these params post-deployment of the Stake Pool.</p></li></ul><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="how-do-we-configure-this-correctly-to-achieve-our-objective"></a>How do we configure this correctly to achieve our objective?<a class="hash-link" href="#how-do-we-configure-this-correctly-to-achieve-our-objective" title="Direct link to heading">#</a></h4><ul><li><p>Set the Fee percentage as X (numerator, denominator) on initialisation (highly likely : the default value of X will be 10%)</p></li><li><p>Set the Fee Beneficiary to be the <code>Fee Authority PDA of the Lido Program</code></p></li><li><p>We want the MultiSig Governance to be able to update these two params</p></li><li><p>In general, we will set <code>Manager of Stake Pool</code> to be our MultiSig Governance program - so this should be taken care of.</p></li></ul><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="context--lido-program"></a>Context : Lido Program<a class="hash-link" href="#context--lido-program" title="Direct link to heading">#</a></h3><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="what-additions-do-we-need-in-the-lido-program"></a>What additions do we need in the Lido Program?<a class="hash-link" href="#what-additions-do-we-need-in-the-lido-program" title="Direct link to heading">#</a></h4><ol><li>Create a Fee Authority (PDA) in the Lido Program</li><li>Set it as Fee Beneficiary in the Stake Pool Program</li><li>Periodically*, this Fee Authority will receive fees in the form of Stake Pool Tokens.</li><li>The intent is to distribute this fees across relevant Lido stakeholders in the form of LSOL.</li></ol><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="configuration-params-required-in-lido-program-can-be-changed-by-governance"></a>Configuration Params required in Lido Program (can be changed by governance)<a class="hash-link" href="#configuration-params-required-in-lido-program-can-be-changed-by-governance" title="Direct link to heading">#</a></h4><ul><li><p>Account Information (aka Recipient Addresses) For</p><ul><li>InsuranceFund : <code>InsuranceFundAddress</code></li><li>TreasuryFund : <code>TreasuryFundAddress</code></li><li>ChorusOneFund : <code>ChorusOneFundAddress</code></li></ul></li><li><p>Params (Save in Lido State. Editable by Governance. With Defaults)</p><ul><li><p>InsuranceFeeNumerator  <code>ifN</code></p></li><li><p>TreasuryFeeNumerator  	<code>tfN</code></p></li><li><p>ChorusFeeNumerator    	<code>cfN</code></p></li><li><p>ValidatorFeeNumerator 	<code>vfN</code></p></li><li><p>Denominator - <code>fDR</code></p></li><li><p>As discussed, let&#x27;s keep a common Denominator and store it in <code>DR</code></p></li><li><p>The 4 fee params store the numerators for the 4 fees respectively</p></li><li><p>Validity Check : ifN + tfN + cfN + vfN == fDR`</p></li></ul></li></ul><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="instructions-required-in-lido-program"></a>Instructions required in Lido Program<a class="hash-link" href="#instructions-required-in-lido-program" title="Direct link to heading">#</a></h4><p>We need the following instructions (and corresponding <code>process_*</code> functions)</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="a-instructions-to-update-above-parameters"></a>A. Instructions to update above parameters<a class="hash-link" href="#a-instructions-to-update-above-parameters" title="Direct link to heading">#</a></h4><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="b-instructions-to-distribute-fees-as-lsol-tokens"></a>B. Instructions to distribute fees (as LSOL tokens)<a class="hash-link" href="#b-instructions-to-distribute-fees-as-lsol-tokens" title="Direct link to heading">#</a></h4><ul><li><p>My understanding here is - because of Solana transaction limits - we will need 2 instructions here.</p></li><li><p><code>DistributeFees</code> : that calculates fees for each stakeholder (in LSOL) and marks it in their name.</p><ul><li>This will require maintaining a data structure - effectively a map from <code>Recipient</code> to <code>LSOL Amount they are entitled to</code>.</li></ul></li></ul><ul><li><p><code>WithdrawFees</code> : with this, anyone can withdraw the LSOL fees  to a recipient (upto the amount the recipient are entitled to)</p></li><li><p>TODO : Confirm with Fynn : Both DistributeFees and WithdrawFees can&#x27;t happen in one step as number of recipients is 3+V (and we don&#x27;t want to bound V to <code>&lt; 10</code> for sure)</p></li></ul><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="distributefees"></a>DistributeFees<a class="hash-link" href="#distributefees" title="Direct link to heading">#</a></h4><ul><li>can be called by a bot every epoch (+ ideally called atleast once every epoch)</li><li>invokes the transfer of Stake Pool tokens held by Fee Authority to Deposit Authority, in lieu of which, LSOL are minted to the Fee Authority so it can distribute it across fee stakeholders</li><li>updates the list of who is entitled to withdraw how many LSOL as fees (list contains Insurance, Treasury, Chorus One and all validators as recipients)</li></ul><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="withdrawfeesrecipient-amount"></a>WithdrawFees(recipient, amount)<a class="hash-link" href="#withdrawfeesrecipient-amount" title="Direct link to heading">#</a></h4><ul><li>With the WithdrawFees function, claimants can withdraw the LSOL they are entitled to in the map maintained by the Fee Authority</li><li>This can be called by anyone, not just the recipient</li><li>Function will try to transfer LSOL to the recipient specified if they are entitled to them as part of the list maintained by DistributeFees.</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="distributefees--in-detail"></a>DistributeFees : In Detail<a class="hash-link" href="#distributefees--in-detail" title="Direct link to heading">#</a></h3><ul><li><p>Starting State : Fee Authority has received <code>t</code> stake pool tokens (as fee beneficiary of the Stake Pool Program)</p></li><li><ol><li>Transfer these <code>t stake pool tokens</code> from  Fee Authority (FA) to Deposit Authority (DA)</li></ol></li><li><ol start="2"><li>Mint new LSOL to the Fee Authority with the calculation<ul><li>`New LSOL Minted to FA  = Total LSOL * (t / Stake Pool Tokens held by Deposit Authority before Transfer of t)</li><li>Update <code>Total LSOL</code></li></ul></li></ol></li><li><ol start="4"><li>For the LSOL Fees, we maintain a map of which stakeholder will get how much LSOL</li></ol><ul><li>Update the map to reflect who all are entitled to these newly minted LSOL (and how much)<ul><li>Insurance</li><li>Treasury</li><li>Chorus One</li><li>Validators - Refer latest list in Stake Pool Program and distribute across the latest list of validators<ul><li>TODO : Check with Fynn about map datastructure. Is map DS supported? Storage limits? This might bound number of Valdiators (~100ish?)</li></ul></li></ul></li></ul></li></ul><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="what-needs-to-be-called-periodically"></a>What needs to be called periodically?<a class="hash-link" href="#what-needs-to-be-called-periodically" title="Direct link to heading">#</a></h3><p>A. PoolBalanceUpdate of Stake Pool Program  (once every epoch by a bot)
B. DistributeFees of Lido Program  (once every epoch by a bot)
C. WithdrawFees(recipient, amount) - possibly the bot can call this periodically for all 3+V stakeholders - to keep the storage light?</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="wip-notes"></a>WIP Notes<a class="hash-link" href="#wip-notes" title="Direct link to heading">#</a></h3><p>Following notes are quite WIP-ish.</p><p>Dependents</p><p>B. Add / Remove Validator</p><ul><li>Note : If validator list is updated in an epoch, it&#x27;s best to check if <code>PoolBalanceUpdate</code> (stake pool program) and <code>DistributeFees</code> (lido program) have occurred in this epoch.<ul><li>The former has a check flag in Stake Pool Program</li><li>The latter can be checked by <code>Stake Pool Token Balance of Fee Authority === 0</code></li><li>We need (Former &amp;&amp; Latter)</li></ul></li></ul><hr><p>TODO : Check with Vasily</p><ul><li>How do we address the distribution of Fees across validators - in the case where they have unequal non-zero commission rates set already?</li></ul><hr></div></article><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Docs pages navigation"><div class="pagination-nav__item"></div><div class="pagination-nav__item pagination-nav__item--next"></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#fee-management" class="table-of-contents__link">Fee Management</a><ul><li><a href="#what-do-we-want-to-achieve" class="table-of-contents__link">What do we want to achieve?</a></li><li><a href="#how-do-we-achieve-this" class="table-of-contents__link">How do we achieve this?</a></li><li><a href="#context--stake-pool-program" class="table-of-contents__link">Context : Stake Pool Program</a></li><li><a href="#context--lido-program" class="table-of-contents__link">Context : Lido Program</a></li><li><a href="#distributefees--in-detail" class="table-of-contents__link">DistributeFees : In Detail</a></li><li><a href="#what-needs-to-be-called-periodically" class="table-of-contents__link">What needs to be called periodically?</a></li><li><a href="#wip-notes" class="table-of-contents__link">WIP Notes</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Docs</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/solido/docs/overview">Documentation</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Community</h4><ul class="footer__items"><li class="footer__item"><a href="https://twitter.com/chorusone" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter</a></li><li class="footer__item"><a href="https://medium.com/chorus-one" target="_blank" rel="noopener noreferrer" class="footer__link-item">Medium</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">More</h4><ul class="footer__items"><li class="footer__item"><a href="https://medium.com/chorus-one/introducing-lido-for-solana-8aa02db8503" target="_blank" rel="noopener noreferrer" class="footer__link-item">Blog</a></li><li class="footer__item"><a href="https://github.com/chorusone/solido" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2021 ChorusOne.</div></div></div></footer></div>
<script src="/solido/assets/js/runtime~main.bb7db0a5.js"></script>
<script src="/solido/assets/js/main.15924cad.js"></script>
</body>
</html>